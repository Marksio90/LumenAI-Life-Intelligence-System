# LumenAI Platform - Helm Chart Values
# Global configuration for all components

global:
  nameOverride: ""
  fullnameOverride: ""
  environment: production
  domain: lumenai.example.com
  imagePullSecrets: []

  # Storage class for persistent volumes
  storageClass: standard-rwo

# Backend Application
backend:
  enabled: true
  replicaCount: 3

  image:
    repository: lumenai/backend
    pullPolicy: Always
    tag: "latest"

  service:
    type: ClusterIP
    port: 8000
    metricsPort: 9090

  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  # Environment variables
  env:
    APP_NAME: "LumenAI"
    LOG_LEVEL: "INFO"
    DEBUG: "false"
    API_PREFIX: "/api/v1"
    WORKERS: "4"

    # Rate Limiting
    RATE_LIMIT_ENABLED: "true"
    RATE_LIMIT_PER_MINUTE: "60"
    RATE_LIMIT_PER_HOUR: "1000"

    # JWT
    JWT_ALGORITHM: "HS256"
    JWT_ACCESS_TOKEN_EXPIRE_MINUTES: "30"
    JWT_REFRESH_TOKEN_EXPIRE_DAYS: "7"

    # LLM
    LLM_PROVIDER: "openai"
    LLM_MODEL: "gpt-4-turbo-preview"
    LLM_TEMPERATURE: "0.7"
    LLM_MAX_TOKENS: "2000"
    LLM_STREAMING_ENABLED: "true"

    # RAG
    RAG_ENABLED: "true"
    RAG_TOP_K: "10"
    RAG_USE_HYBRID: "true"
    RAG_USE_RERANK: "true"
    RAG_ALPHA: "0.5"
    EMBEDDING_MODEL: "text-embedding-3-large"
    EMBEDDING_DIMENSION: "3072"
    RERANK_MODEL: "rerank-english-v3.0"
    CHUNK_SIZE: "1000"
    CHUNK_OVERLAP: "200"

    # Context Management
    MAX_CONTEXT_TOKENS: "4000"
    MAX_HISTORY_LENGTH: "20"
    SUMMARIZATION_THRESHOLD: "0.8"

    # Agent Configuration
    AGENT_LOAD_BALANCING: "least_loaded"
    AGENT_CIRCUIT_BREAKER_THRESHOLD: "5"
    AGENT_CIRCUIT_BREAKER_TIMEOUT: "60"

    # Monitoring
    PROMETHEUS_ENABLED: "true"
    METRICS_PORT: "9090"

  # Secrets (should be overridden in production)
  secrets:
    jwtSecretKey: "CHANGE_ME_IN_PRODUCTION"
    jwtRefreshSecretKey: "CHANGE_ME_IN_PRODUCTION"
    openaiApiKey: "sk-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
    cohereApiKey: "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
    anthropicApiKey: "sk-ant-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

# Frontend Application
frontend:
  enabled: true
  replicaCount: 3

  image:
    repository: lumenai/frontend
    pullPolicy: Always
    tag: "latest"

  service:
    type: ClusterIP
    port: 3000

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "500m"

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 15
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  env:
    NEXT_PUBLIC_APP_NAME: "LumenAI"
    NEXT_PUBLIC_APP_VERSION: "1.0.0"
    NEXT_PUBLIC_ENABLE_RAG: "true"
    NEXT_PUBLIC_ENABLE_STREAMING: "true"
    NEXT_PUBLIC_ENABLE_VOICE: "true"
    NEXT_PUBLIC_DEFAULT_THEME: "light"

# Qdrant Vector Database
qdrant:
  enabled: true
  replicaCount: 3

  image:
    repository: qdrant/qdrant
    pullPolicy: IfNotPresent
    tag: "v1.7.4"

  service:
    type: ClusterIP
    httpPort: 6333
    grpcPort: 6334

  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

  persistence:
    enabled: true
    size: 50Gi
    storageClass: ""  # Uses global.storageClass if empty

  env:
    QDRANT__SERVICE__GRPC_PORT: "6334"
    QDRANT__LOG_LEVEL: "INFO"
    QDRANT__CLUSTER__ENABLED: "true"
    QDRANT__CLUSTER__P2P__PORT: "6335"
    QDRANT__STORAGE__PERFORMANCE__MAX_SEARCH_THREADS: "4"
    QDRANT__SERVICE__MAX_REQUEST_SIZE_MB: "32"

  podDisruptionBudget:
    enabled: true
    minAvailable: 2

# Redis Cache
redis:
  enabled: true
  replicaCount: 3

  image:
    repository: redis
    pullPolicy: IfNotPresent
    tag: "7.2-alpine"

  service:
    type: ClusterIP
    port: 6379

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""

  config:
    maxmemory: "2gb"
    maxmemoryPolicy: "allkeys-lru"
    appendonly: "yes"
    appendfsync: "everysec"

  exporter:
    enabled: true
    image:
      repository: oliver006/redis_exporter
      tag: "v1.55.0-alpine"
    resources:
      requests:
        memory: "32Mi"
        cpu: "10m"
      limits:
        memory: "128Mi"
        cpu: "100m"

  podDisruptionBudget:
    enabled: true
    minAvailable: 2

# MongoDB Database
mongodb:
  enabled: true
  replicaCount: 3

  image:
    repository: mongo
    pullPolicy: IfNotPresent
    tag: "7.0"

  service:
    type: ClusterIP
    port: 27017

  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

  persistence:
    enabled: true
    size: 100Gi
    storageClass: ""

  auth:
    enabled: true
    username: "lumenai_user"
    password: "CHANGE_ME_IN_PRODUCTION"
    database: "lumenai"

  replicaSet:
    enabled: true
    name: "rs0"

  exporter:
    enabled: true
    image:
      repository: percona/mongodb_exporter
      tag: "0.40"
    resources:
      requests:
        memory: "64Mi"
        cpu: "10m"
      limits:
        memory: "256Mi"
        cpu: "100m"

  podDisruptionBudget:
    enabled: true
    minAvailable: 2

# Ingress Configuration
ingress:
  enabled: true
  className: "nginx"

  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/limit-rps: "100"
    nginx.ingress.kubernetes.io/limit-connections: "50"
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/websocket-services: "lumenai-backend"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"

  tls:
    enabled: true
    secretName: lumenai-tls-secret

  hosts:
    - host: lumenai.example.com
      paths:
        - path: /
          pathType: Prefix
          service: frontend
          port: 3000
    - host: api.lumenai.example.com
      paths:
        - path: /
          pathType: Prefix
          service: backend
          port: 8000

# Certificate Manager
certManager:
  enabled: true
  email: "admin@lumenai.example.com"

  clusterIssuer:
    production:
      enabled: true
      name: "letsencrypt-prod"
      server: "https://acme-v02.api.letsencrypt.org/directory"
    staging:
      enabled: true
      name: "letsencrypt-staging"
      server: "https://acme-staging-v02.api.letsencrypt.org/directory"

# Ingress NGINX Controller
ingressNginx:
  enabled: true

  controller:
    replicaCount: 2

    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "1Gi"
        cpu: "500m"

    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 70

    config:
      use-forwarded-headers: "true"
      compute-full-forwarded-for: "true"
      use-proxy-protocol: "false"
      enable-brotli: "true"
      enable-real-ip: "true"
      proxy-buffer-size: "16k"
      proxy-body-size: "50m"

# Monitoring Stack
monitoring:
  prometheus:
    enabled: true
    replicaCount: 1

    image:
      repository: prom/prometheus
      tag: "v2.48.0"

    resources:
      requests:
        memory: "512Mi"
        cpu: "250m"
      limits:
        memory: "2Gi"
        cpu: "1000m"

    persistence:
      enabled: true
      size: 50Gi
      storageClass: ""

    retention: "30d"

  grafana:
    enabled: true
    replicaCount: 1

    image:
      repository: grafana/grafana
      tag: "10.2.2"

    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "1Gi"
        cpu: "500m"

    persistence:
      enabled: true
      size: 10Gi
      storageClass: ""

    admin:
      user: "admin"
      password: "CHANGE_ME_IN_PRODUCTION"

    dashboards:
      enabled: true

# Security Settings
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

podSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
    - ALL

# Network Policies
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress

# Service Mesh (Optional)
serviceMesh:
  enabled: false
  type: "istio"  # istio, linkerd, consul

# Backup Configuration
backup:
  enabled: false
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 7  # days

  targets:
    - mongodb
    - qdrant
    - redis

# Disaster Recovery
disasterRecovery:
  enabled: false
  multiRegion: false
  replicationFactor: 3
